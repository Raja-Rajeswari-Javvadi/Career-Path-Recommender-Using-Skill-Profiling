<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your AI Career Roadmap</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
    --primary-gradient: linear-gradient(135deg,#6366f1,#a855f7);
    --glass-bg: rgba(255,255,255,0.92);
}

body{
    background:#f1f5f9 url('https://ik.imagekit.io/fu4uxhoyq/ChatGPT%20Image%20Feb%204,%202026,%2010_30_59%20AM.png?updatedAt=1770283446788') no-repeat center top fixed;
    background-size:cover;
    font-family:'Inter',sans-serif;
    min-height:100vh;
}

/* ROADMAP UI */

.content-wrapper{
    display:flex;
    padding:40px 0 40px 6%;
    min-height:100vh;
    align-items:center;
}

.glass-card{
    background:var(--glass-bg);
    border-radius:24px;
    padding:40px;
    box-shadow:0 20px 50px rgba(0,0,0,.15);
    max-width:620px;
    width:100%;
}

.match-badge{
    background:var(--primary-gradient);
    color:#fff;
    padding:2px 12px;
    border-radius:20px;
    font-size:.85rem;
    margin-left:auto;
}

.chart-container{height:160px;margin-bottom:20px;}

/* CHATBOT */

#chat-widget-button{
    position:fixed;
    bottom:30px;
    right:30px;
    width:60px;
    height:60px;
    background:var(--primary-gradient);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 10px 25px rgba(99,102,241,0.4);
    cursor:pointer;
    z-index:1000;
}

#chat-window{
    position:fixed;
    bottom:100px;
    right:30px;
    width:380px;
    height:520px;
    background:rgba(255,255,255,0.98);
    backdrop-filter:blur(20px);
    border-radius:24px;
    display:none;
    flex-direction:column;
    box-shadow:0 15px 45px rgba(0,0,0,0.2);
    overflow:hidden;
    animation:slideUp .4s ease;
}

@keyframes slideUp{
    from{transform:translateY(20px);opacity:0}
    to{transform:translateY(0);opacity:1}
}

.chat-header{
    background:var(--primary-gradient);
    color:white;
    padding:14px 18px;
    font-weight:700;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.chat-body{
    flex:1;
    overflow-y:auto;
    padding:18px;
    display:flex;
    flex-direction:column;
    gap:12px;
    background:#f8fafc;
}

.chat-input-area{
    padding:14px;
    border-top:1px solid #eee;
    background:white;
    display:flex;
    gap:10px;
}

.msg{
    padding:12px 16px;
    border-radius:18px;
    max-width:85%;
    font-size:.92rem;
    line-height:1.6;
}

.msg-user{
    background:#6366f1;
    color:white;
    align-self:flex-end;
    border-bottom-right-radius:4px;
}

.msg-ai{
    background:white;
    color:#1e293b;
    align-self:flex-start;
    border-bottom-left-radius:4px;
    border:1px solid #e2e8f0;
}

.msg-ai strong{
    color:#4338ca;
}
</style>
</head>

<body>

<div class="content-wrapper">
<div class="glass-card">

<div id="loadingView" class="text-center">
<div class="spinner-border text-primary mb-4" style="width:3.5rem;height:3.5rem;"></div>
<h4>Crafting Your Future...</h4>
</div>

<div id="resultView" style="display:none;">
<h2 class="fw-bold mb-3">Strategic Roadmaps</h2>

<div class="accordion accordion-flush shadow-sm border rounded-3" id="careerAccordion">

<div class="accordion-item">
<button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
<span id="title1">Path 1</span>
<span class="match-badge" id="badge1">--%</span>
</button>
<div id="collapseOne" class="accordion-collapse collapse show">
<div class="accordion-body">
<div class="chart-container"><canvas id="chart1"></canvas></div>
<div id="path1-content"></div>
</div></div></div>

<div class="accordion-item">
<button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
<span id="title2">Path 2</span>
<span class="match-badge" id="badge2">--%</span>
</button>
<div id="collapseTwo" class="accordion-collapse collapse">
<div class="accordion-body">
<div class="chart-container"><canvas id="chart2"></canvas></div>
<div id="path2-content"></div>
</div></div></div>

<div class="accordion-item">
<button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#collapseThree">
<span id="title3">Path 3</span>
<span class="match-badge" id="badge3">--%</span>
</button>
<div id="collapseThree" class="accordion-collapse collapse">
<div class="accordion-body">
<div class="chart-container"><canvas id="chart3"></canvas></div>
<div id="path3-content"></div>
</div></div></div>

</div>

<div id="motivation" class="mt-3"></div>
</div>
</div>
</div>

<!-- CHATBOT BUTTON -->
<div id="chat-widget-button" onclick="toggleChat()">
<i class="bi bi-robot text-white fs-3"></i>
</div>

<!-- CHAT WINDOW -->
<div id="chat-window">
<div class="chat-header">
Career Mentor AI
<i class="bi bi-x-lg" style="cursor:pointer" onclick="toggleChat()"></i>
</div>

<div class="chat-body" id="chatBody">
<div class="msg msg-ai">Hello! Iâ€™ve analyzed your roadmap. Ask me anything ðŸš€</div>
</div>

<div class="chat-input-area">
<input type="text" id="chatInput" class="form-control rounded-pill" placeholder="Ask about your roadmap..." onkeypress="if(event.key==='Enter') sendMessage()">
<button onclick="sendMessage()" class="btn btn-primary rounded-circle">
<i class="bi bi-send"></i>
</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>

let careerScores=[];

/* LOAD ROADMAP */

async function loadData(){
const profile=sessionStorage.getItem("userProfile");
if(!profile){window.location.href="/";return;}

const formData=new FormData();
const dataObj=JSON.parse(profile);
for(const key in dataObj){formData.append(key,dataObj[key]);}

const response=await fetch("/recommend",{method:"POST",body:formData});
const result=await response.json();

const tempDiv=document.createElement('div');
tempDiv.innerHTML=result.report;
const paths=tempDiv.querySelectorAll('h3');

paths.forEach((pathHeading,index)=>{
let content="";
let nextSibling=pathHeading.nextElementSibling;
while(nextSibling && nextSibling.tagName!=='H3'){
content+=nextSibling.outerHTML;
nextSibling=nextSibling.nextElementSibling;
}

document.getElementById(`title${index+1}`).innerText=pathHeading.innerText;
document.getElementById(`path${index+1}-content`).innerHTML=content;

const scoreMatch=content.match(/(\d+)\/100/);
const score=scoreMatch?parseInt(scoreMatch[1]):80;

document.getElementById(`badge${index+1}`).innerText=score+"% Match";
renderChart(`chart${index+1}`,score);
});

document.getElementById("loadingView").style.display="none";
document.getElementById("resultView").style.display="block";

if(result.motivation)
document.getElementById("motivation").innerHTML="âœ¨ "+result.motivation;
}

/* CHART */

function renderChart(id,score){
new Chart(document.getElementById(id),{
type:'bar',
data:{labels:['Match'],datasets:[{data:[score]}]},
options:{indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{max:100}}}
});
}

/* CHATBOT */

function toggleChat(){
const win=document.getElementById("chat-window");
win.style.display=win.style.display==="flex"?"none":"flex";
}

async function sendMessage(){
const input=document.getElementById("chatInput");
const body=document.getElementById("chatBody");
if(!input.value.trim()) return;

const userMsg=input.value;

body.innerHTML+=`<div class="msg msg-user">${userMsg}</div>`;
input.value="";
body.scrollTop=body.scrollHeight;

const loadingId="ai-"+Date.now();
body.innerHTML+=`<div class="msg msg-ai" id="${loadingId}"><div class="spinner-grow spinner-grow-sm text-primary"></div></div>`;

const response=await fetch("/chat",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({message:userMsg,context:document.getElementById('resultView').innerText})
});

const data=await response.json();
document.getElementById(loadingId).innerHTML=marked.parse(data.reply);

body.scrollTop=body.scrollHeight;
}

window.onload=loadData;

</script>
</body>
</html>
